Vagrant.configure("2") do |config|

	# Load config JSON
	setup_config_path = "<%= @config_path %>"
	setup_config = JSON.parse(File.read(setup_config_path))

	# Base box
	config.vm.box = "precise32"
	config.vm.box_url = "http://files.vagrantup.com/precise32.box"

	# Networking
	config.vm.network :private_network, ip: setup_config["ip"]

	# Customize provider
	config.vm.provider :virtualbox do |vb|
		# RAM
		vb.customize ["modifyvm", :id, "--memory", setup_config["memory"]]

		# Synced Folder
		unless setup_config["synced_folder"].nil?
			config.vm.synced_folder setup_config["synced_folder"]["host_path"], setup_config["synced_folder"]["guest_path"]
		end
	end

	# Customize provisioner
	config.vm.provision :chef_solo do |chef|
		chef.json = setup_config

		chef.cookbooks_path = []
		<% for @cookbook_path in @cookbook_paths %>
		chef.cookbooks_path << "<%= @cookbook_path %>"
		<% end %>

		chef.roles_path = []
		<% for @role_path in @role_paths %>
		chef.roles_path << "<%= @role_path %>"
		<% end %>

		# Add roles
		setup_config["roles"].each do |role|
			chef.add_role role
		end
	end

end
